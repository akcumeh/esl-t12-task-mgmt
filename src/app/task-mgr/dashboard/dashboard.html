<div class="dashboard-container">
    <div class="header">
        <h1>Task Manager - Dashboard</h1>
        <button mat-fab color="primary" (click)="navigateToAddTask()" class="add-button mobile-only">
            <mat-icon>add</mat-icon>
        </button>
        <button mat-raised-button color="primary" (click)="navigateToAddTask()" class="add-button desktop-only">
            <mat-icon>add</mat-icon>
            Add Task
        </button>
    </div>

    <!-- Desktop: 3 columns -->
    <div class="task-columns desktop-view">
        <div class="column">
            <h2>New</h2>
            <div cdkDropList [cdkDropListData]="newTasks()" [cdkDropListConnectedTo]="['progress-list', 'done-list']"
                 id="new-list" (cdkDropListDropped)="drop($event)">
                @for (task of newTasks(); track task.id) {
                <div cdkDrag class="task-card">
                    <div class="task-content">
                        <h3>{{ task.title }}</h3>
                        <p>{{ task.description }}</p>
                    </div>
                </div>
                }
            </div>
        </div>
        <div class="column">
            <h2>In Progress</h2>
            <div cdkDropList [cdkDropListData]="progressTasks()" [cdkDropListConnectedTo]="['new-list', 'done-list']"
                 id="progress-list" (cdkDropListDropped)="drop($event)">
                @for (task of progressTasks(); track task.id) {
                <div cdkDrag class="task-card">
                    <div class="task-content">
                        <h3>{{ task.title }}</h3>
                        <p>{{ task.description }}</p>
                    </div>
                </div>
                }
            </div>
        </div>
        <div class="column">
            <h2>Done</h2>
            <div cdkDropList [cdkDropListData]="doneTasks()" [cdkDropListConnectedTo]="['new-list', 'progress-list']"
                 id="done-list" (cdkDropListDropped)="drop($event)">
                @for (task of doneTasks(); track task.id) {
                <div cdkDrag class="task-card completed">
                    <div class="task-content">
                        <h3>{{ task.title }}</h3>
                        <p>{{ task.description }}</p>
                    </div>
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Mobile: Collapsible sections -->
    <div class="mobile-view">
        <div class="mobile-section">
            <h2 (click)="toggleSection('new')" class="collapsible-header">
                New
                <mat-icon>{{ expandedSections.new ? 'expand_less' : 'expand_more' }}</mat-icon>
            </h2>
            @if (expandedSections.new) {
            <div cdkDropList [cdkDropListData]="newTasks()"
                 [cdkDropListConnectedTo]="['mobile-progress-list', 'mobile-done-list']" id="mobile-new-list"
                 (cdkDropListDropped)="drop($event)">
                @for (task of newTasks(); track task.id) {
                <div cdkDrag class="task-card mobile-card">
                    <h3>{{ task.title }}</h3>
                    <p>{{ task.description }}</p>
                </div>
                }
            </div>
            }
        </div>

        <div class="mobile-section">
            <h2 (click)="toggleSection('progress')" class="collapsible-header">
                In Progress
                <mat-icon>{{ expandedSections.progress ? 'expand_less' : 'expand_more' }}</mat-icon>
            </h2>
            @if (expandedSections.progress) {
            <div cdkDropList [cdkDropListData]="progressTasks()"
                 [cdkDropListConnectedTo]="['mobile-new-list', 'mobile-done-list']" id="mobile-progress-list"
                 (cdkDropListDropped)="drop($event)">
                @for (task of progressTasks(); track task.id) {
                <div cdkDrag class="task-card mobile-card">
                    <h3>{{ task.title }}</h3>
                    <p>{{ task.description }}</p>
                </div>
                }
            </div>
            }
        </div>

        <div class="mobile-section">
            <h2 (click)="toggleSection('done')" class="collapsible-header">
                Done
                <mat-icon>{{ expandedSections.done ? 'expand_less' : 'expand_more' }}</mat-icon>
            </h2>
            @if (expandedSections.done) {
            <div cdkDropList [cdkDropListData]="doneTasks()"
                 [cdkDropListConnectedTo]="['mobile-new-list', 'mobile-progress-list']" id="mobile-done-list"
                 (cdkDropListDropped)="drop($event)">
                @for (task of doneTasks(); track task.id) {
                <div cdkDrag class="task-card mobile-card completed">
                    <h3>{{ task.title }}</h3>
                    <p>{{ task.description }}</p>
                </div>
                }
            </div>
            }
        </div>
    </div>
</div>